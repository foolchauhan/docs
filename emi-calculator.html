<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Smart EMI Planner</title>

<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
body {
  background: radial-gradient(circle at top, #1a2a6c, #16222a);
  color: #222;
}

.card {
  border-radius: 20px;
  box-shadow: 0 25px 60px rgba(0,0,0,0.35);
}

h2, h5 {
  font-weight: 700;
}

.meta {
  font-size: 0.85rem;
  color: #6c757d;
}

.completion {
  background: linear-gradient(135deg, #11998e, #38ef7d);
  color: white;
  border-radius: 14px;
  padding: 18px;
  text-align: center;
  font-size: 1.15rem;
  box-shadow: 0 10px 30px rgba(0,0,0,0.3);
}

canvas {
  background: #0f172a;
  border-radius: 16px;
  padding: 10px;
}

.table {
  font-size: 0.85rem;
}

input[type=range] {
  accent-color: #38ef7d;
}
</style>
</head>

<body>
<div class="container my-5">
<div class="card p-4 bg-light">

<h2 class="text-center mb-4">Smart EMI Planner</h2>

<div class="row">
<div class="col-md-6">

<h5>Loan Details</h5>

<label>Loan Amount (₹)</label>
<input type="range" id="amountSlider" min="500000" max="15000000" step="10000">
<input type="number" id="amount" class="form-control mb-3">

<label>Interest Rate (% p.a.)</label>
<input type="range" id="rateSlider" min="5" max="15" step="0.05">
<input type="number" step="0.05" id="rate" class="form-control mb-3">

<label>Tenure (Months)</label>
<input type="range" id="tenureSlider" min="12" max="360">
<input type="number" id="tenure" class="form-control">
<div class="meta">
(<span id="tenureYears"></span> years)
</div>

</div>

<div class="col-md-6">

<h5>EMI Controls</h5>

<label>Base EMI (₹)</label>
<input type="number" id="emi" class="form-control mb-3">

<label>Annual Step-Up (%)</label>
<input type="range" id="stepSlider" min="0" max="20" step="0.5">
<input type="number" step="0.5" id="step" class="form-control mb-2">
<div class="meta">Step-up affects tenure only</div>

<div class="completion mt-4">
Loan Completion<br>
<span id="completionDate"></span>
</div>

</div>
</div>

<hr>

<h5 class="mt-3">Normal vs Step-Up Comparison</h5>
<table class="table table-bordered text-center">
<thead class="thead-light">
<tr>
<th></th>
<th>Normal</th>
<th>Step-Up</th>
</tr>
</thead>
<tbody>
<tr>
<td>Tenure (months)</td>
<td id="normalTenure"></td>
<td id="stepTenure"></td>
</tr>
<tr>
<td>Total Interest (₹)</td>
<td id="normalInterest"></td>
<td id="stepInterest"></td>
</tr>
</tbody>
</table>

<!-- Charts side by side -->
<div class="row mt-4">
<div class="col-md-6">
<canvas id="pieChart" height="260"></canvas>
</div>
<div class="col-md-6">
<canvas id="balanceChart" height="260"></canvas>
</div>
</div>

<h5 class="mt-5">Amortization Schedule (Step-Up)</h5>
<div class="table-responsive">
<table class="table table-striped table-sm" id="amortTable">
<thead>
<tr>
<th>Month</th>
<th>EMI</th>
<th>Principal</th>
<th>Interest</th>
<th>Balance</th>
</tr>
</thead>
<tbody></tbody>
</table>
</div>

</div>
</div>

<script>
const A = amount;
const AS = amountSlider;
const R = rate;
const RS = rateSlider;
const T = tenure;
const TS = tenureSlider;
const EMI = emi;
const STEP = step;
const STEPS = stepSlider;

const pieCanvas = document.getElementById("pieChart");
const balCanvas = document.getElementById("balanceChart");

let pieChart, balanceChart;

function calcEMI(P, r, n) {
  r /= 1200;
  return P * r * Math.pow(1+r, n) / (Math.pow(1+r, n)-1);
}

function calcTenure(P, r, emi) {
  r /= 1200;
  return Math.log(emi/(emi-P*r)) / Math.log(1+r);
}

function simulate(P, r, emi, step) {
  let bal=P, m=0, iSum=0, yearly=[], rows=[];
  let curEMI=emi, mr=r/1200;
  let start=new Date();

  while(bal>0 && m<600){
    let i=bal*mr, p=curEMI-i;
    if(p<=0) break;
    bal-=p; iSum+=i; m++;

    let d=new Date(start);
    d.setMonth(d.getMonth()+m-1);

    rows.push({
      label:`${m} (${d.toLocaleString("default",{month:"short"})} ${d.getFullYear()})`,
      emi:curEMI, p, i, bal:Math.max(bal,0)
    });

    if(m%12===0){
      yearly.push(Math.max(bal,0));
      curEMI*=1+step/100;
    }
  }
  return {months:m, interest:iSum, yearly, rows};
}

function recalc(src="all"){
  let P=+A.value, r=+R.value, n=+T.value, e=+EMI.value;

  if(src==="amount"||src==="rate"||src==="tenure"){
    e=calcEMI(P,r,n);
    EMI.value=Math.round(e);
  }
  if(src==="emi"){
    n=Math.round(calcTenure(P,r,e));
    T.value=TS.value=n;
  }

  let normal=simulate(P,r,e,0);
  let stepUp=simulate(P,r,e,+STEP.value);

  if(src==="step"){
    T.value=TS.value=stepUp.months;
  }

  tenureYears.innerText=(T.value/12).toFixed(2);
  normalTenure.innerText=normal.months;
  stepTenure.innerText=stepUp.months;
  normalInterest.innerText=Math.round(normal.interest);
  stepInterest.innerText=Math.round(stepUp.interest);

  let end=new Date(); end.setMonth(end.getMonth()+stepUp.months);
  completionDate.innerText=end.toLocaleString("default",{month:"long"})+" "+end.getFullYear();

  renderCharts(P,stepUp.interest,stepUp.yearly);
  renderTable(stepUp.rows);
}

function renderCharts(P,I,Y){
  if(pieChart) pieChart.destroy();
  pieChart=new Chart(pieCanvas,{
    type:"doughnut",
    data:{
      labels:["Principal","Interest"],
      datasets:[{
        data:[P,I],
        backgroundColor:[
          "rgba(56,239,125,0.9)",
          "rgba(239,68,68,0.9)"
        ],
        borderWidth:0
      }]
    },
    options:{
      cutout:"65%",
      plugins:{legend:{labels:{color:"#fff"}}}
    }
  });

  if(balanceChart) balanceChart.destroy();
  balanceChart=new Chart(balCanvas,{
    type:"line",
    data:{
      labels:Y.map((_,i)=>"Year "+(i+1)),
      datasets:[{
        data:Y,
        borderColor:"#38ef7d",
        backgroundColor:"rgba(56,239,125,0.2)",
        fill:true,
        tension:0.4
      }]
    },
    options:{
      plugins:{legend:{display:false}},
      scales:{
        x:{ticks:{color:"#fff"}},
        y:{ticks:{color:"#fff"}}
      }
    }
  });
}

function renderTable(rows){
  let tb=document.querySelector("#amortTable tbody");
  tb.innerHTML="";
  rows.forEach(r=>{
    tb.innerHTML+=`<tr>
      <td>${r.label}</td>
      <td>${Math.round(r.emi)}</td>
      <td>${Math.round(r.p)}</td>
      <td>${Math.round(r.i)}</td>
      <td>${Math.round(r.bal)}</td>
    </tr>`;
  });
}

function sync(s,i,k){
  s.oninput=()=>{i.value=s.value;recalc(k);}
  i.oninput=()=>{s.value=i.value;recalc(k);}
}

sync(AS,A,"amount");
sync(RS,R,"rate");
sync(TS,T,"tenure");
sync(STEPS,STEP,"step");
EMI.oninput=()=>recalc("emi");

A.value=AS.value=8658410;
R.value=RS.value=7.75;
T.value=TS.value=190;
STEP.value=STEPS.value=10;
EMI.value=Math.round(calcEMI(8658410,7.75,190));
recalc();
</script>
</body>
</html>
